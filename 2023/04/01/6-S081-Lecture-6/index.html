<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MIT 6.S081 Lecture 6: Isolation &amp; system call entry/exit | Huayi</title><meta name="author" content="Huayi"><meta name="copyright" content="Huayi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Reading  Read Chapter4  read code">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT 6.S081 Lecture 6: Isolation &amp; system call entry&#x2F;exit">
<meta property="og:url" content="http://blog.huaeryi.top/2023/04/01/6-S081-Lecture-6/index.html">
<meta property="og:site_name" content="Huayi">
<meta property="og:description" content="Reading  Read Chapter4  read code">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://blog.huaeryi.top/image/sheep.png">
<meta property="article:published_time" content="2023-04-01T06:03:15.000Z">
<meta property="article:modified_time" content="2023-04-15T07:16:56.497Z">
<meta property="article:author" content="Huayi">
<meta property="article:tag" content="C">
<meta property="article:tag" content="OS">
<meta property="article:tag" content="RISC-V">
<meta property="article:tag" content="GNU Make">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.huaeryi.top/image/sheep.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MIT 6.S081 Lecture 6: Isolation & system call entry/exit",
  "url": "http://blog.huaeryi.top/2023/04/01/6-S081-Lecture-6/",
  "image": "http://blog.huaeryi.top/image/sheep.png",
  "datePublished": "2023-04-01T06:03:15.000Z",
  "dateModified": "2023-04-15T07:16:56.497Z",
  "author": [
    {
      "@type": "Person",
      "name": "Huayi",
      "url": "http://blog.huaeryi.top"
    }
  ]
}</script><link rel="shortcut icon" href="/image/sheep.png"><link rel="canonical" href="http://blog.huaeryi.top/2023/04/01/6-S081-Lecture-6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MIT 6.S081 Lecture 6: Isolation & system call entry/exit',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Huayi" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/image/sheep.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">92</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">18</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/image/background.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/image/sheep.png" alt="Logo"><span class="site-name">Huayi</span></a><a class="nav-page-title" href="/"><span class="site-name">MIT 6.S081 Lecture 6: Isolation &amp; system call entry/exit</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MIT 6.S081 Lecture 6: Isolation &amp; system call entry/exit</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-04-01T06:03:15.000Z" title="å‘è¡¨äº 2023-04-01 14:03:15">2023-04-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-04-15T07:16:56.497Z" title="æ›´æ–°äº 2023-04-15 15:16:56">2023-04-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">580</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>2åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h3 id="Reading-12">Reading</h3>
<ul class="lvl-0">
<li class="lvl-2"><a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2021/xv6/book-riscv-rev2.pdf">Read Chapter4</a><br>
<img src="/2023/04/01/6-S081-Lecture-6/Chapter4.png" alt="Chapter4"></li>
<li class="lvl-2">read code<br>
<img src="/2023/04/01/6-S081-Lecture-6/read6.png" alt="read"></li>
</ul>
<span id="more"></span>
<h3 id="Traps">Traps</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>å®ç°ç”¨æˆ·å±‚å’Œå†…æ ¸å±‚åˆ‡æ¢çš„æœºåˆ¶</p>
</li>
<li class="lvl-2">
<p>å‘ç”Ÿåœ¨å¦‚ç³»ç»Ÿè°ƒç”¨ã€Page Faultã€/0çš„è¿‡ç¨‹ä¸­</p>
</li>
<li class="lvl-2">
<p>Traps register<br>
<img src="/2023/04/01/6-S081-Lecture-6/Trapsreg.png" alt="Trapsregister"></p>
<ul class="lvl-2">
<li class="lvl-4">32ä¸ªé€šç”¨register åŒ…æ‹¬spæ ˆæŒ‡é’ˆ</li>
<li class="lvl-4">PC ç¨‹åºè®¡æ•°å™¨</li>
<li class="lvl-4">MODE ä»£è¡¨å½“å‰åœ¨ç”¨æˆ·æ¨¡å¼è¿˜æ˜¯å†…æ ¸æ¨¡å¼</li>
<li class="lvl-4">SATP æŒ‡å‘pagetableçš„ç‰©ç†åœ°å€</li>
<li class="lvl-4">STVEC æŒ‡å‘trapæŒ‡ä»¤çš„èµ·å§‹åœ°å€ trapoline page</li>
<li class="lvl-4">SEPC åœ¨trapæ—¶ä¿å­˜PC</li>
<li class="lvl-4">SSRACTCH æŒ‡å‘trapframe page</li>
</ul>
</li>
<li class="lvl-2">
<p>supervisor mode<br>
<img src="/2023/04/01/6-S081-Lecture-6/supervisor.png" alt="supervisor"></p>
<ul class="lvl-2">
<li class="lvl-4">supervisor modeå¯ä»¥è¯»å†™ä¸Šè¿°æ§åˆ¶å¯„å­˜å™¨ï¼Œå¹¶ä¸”å¯ä»¥è¯»å†™PTE_U = 0çš„page</li>
</ul>
</li>
<li class="lvl-2">
<p>Traps process(shell write as example)<br>
<img src="/2023/04/01/6-S081-Lecture-6/Traps.png" alt="Traps"></p>
<ul class="lvl-2">
<li class="lvl-4">uservecå’Œuserretæ˜¯trampoline.Sä¸­çš„å‡½æ•°</li>
<li class="lvl-4">usertrap()å’Œusertrapret()æ˜¯trap.cä¸­çš„å‡½æ•°</li>
<li class="lvl-4">syscall()æ˜¯syscall.cä¸­çš„å‡½æ•°ï¼Œå®ƒæ ¹æ®å¯„å­˜å™¨ä¼ å…¥çš„å‚æ•°è°ƒç”¨ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚sys_write()</li>
<li class="lvl-4">ä¸Šè¿°æ–‡ä»¶å‡åœ¨kernelæ–‡ä»¶å¤¹ä¸­</li>
</ul>
</li>
<li class="lvl-2">
<p>å†…å­˜æ˜ å°„æ–‡ä»¶(Memory-mapped file access)æœºåˆ¶ï¼Œå°†ç”¨æˆ·ç©ºé—´çš„è™šæ‹Ÿåœ°å€ç©ºé—´ç›´æ¥æ˜ å°„åˆ°æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥é€šè¿‡å†…å­˜åœ°å€ç›´æ¥è¯»å†™æ–‡ä»¶ï¼Œè¿™æ¯”read writeç³»ç»Ÿè°ƒç”¨å¿«ä¸Šè®¸å¤šï¼Œè¿™ä¸€åŠŸèƒ½å°†åœ¨Lab mmapä¸­å®ç°</p>
</li>
</ul>
<h3 id="gdbè°ƒè¯•traps">gdbè°ƒè¯•traps</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>.asm</code>æ˜¯å¸¦æœ‰æŒ‡ä»¤åœ°å€çš„æ±‡ç¼–ä»£ç  <code>.S</code>åˆ™æ²¡æœ‰æŒ‡ä»¤åœ°å€</p>
</li>
<li class="lvl-2">
<p><code>ctrl-a c</code> è¿›å…¥qemuçš„consolcc</p>
<ul class="lvl-2">
<li class="lvl-4"><code>info mem</code>æ‰“å°pagetable</li>
</ul>
</li>
<li class="lvl-2">
<p><code>csrrw a0, sscratch, a0</code> äº¤æ¢äº†a0å’Œsscratchçš„å†…å®¹</p>
</li>
<li class="lvl-2">
<p>åœ¨trampoline pageä¸­æ‰§è¡Œtrapsï¼Œtrampoline pageåŒ…å«äº†å†…æ ¸çš„trapå¤„ç†ä»£ç ï¼Œè¿™ä¸ªæ“ä½œç”±å†…æ ¸é€šè¿‡stvecå°å¿ƒåœ°æ˜ å°„åˆ°ç”¨æˆ·pagetableï¼Œä½†æ˜¯ç”±äºPTE_Uè®¾ç½®ä¸º0ï¼Œæ‰€ä»¥ä¸å—ç”¨æˆ·å½±å“</p>
</li>
<li class="lvl-2">
<p>åœ¨RISC-Vä¸­ï¼Œecallå°½é‡ç®€å•ï¼Œç”±è½¯ä»¶ä¹Ÿå³OSå®ç°äº†trapsæœºåˆ¶ï¼Œç›®çš„æ˜¯å®ç°è½¯ä»¶çš„çµæ´»æ€§ï¼Œecallåªå¹²ä¸‰ä»¶äº‹</p>
<ul class="lvl-2">
<li class="lvl-4">ecallä»user modeåˆ‡æ¢åˆ°supervisor mode</li>
<li class="lvl-4">ecallå°†pcçš„å€¼ä¿å­˜åœ¨sepc</li>
<li class="lvl-4">ecallè·³è½¬åˆ°stvecæŒ‡å‘çš„æŒ‡ä»¤</li>
</ul>
</li>
<li class="lvl-2">
<p>RISC-Våœ¨æ¯ä¸ªç”¨æˆ·è¿›ç¨‹çš„pagetableä¸­æ˜ å°„äº†trapframe pageï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯ä¿å­˜äº†32ä¸ªç”¨æˆ·é€šç”¨å¯„å­˜å™¨ï¼Œåœ¨è¿›å…¥trapsä¹‹å‰ï¼Œè¿™ä¸ªåœ°å€ä¼šä¿å­˜åœ¨sscratchä¸­</p>
</li>
<li class="lvl-2">
<p>trapframeç»“æ„å®šä¹‰åœ¨proc.hä¸­</p>
</li>
<li class="lvl-2">
<p>ä¹‹åä»user pagetableåˆ‡æ¢åˆ°kernel pagetableï¼Œç¨‹åºä¹‹æ‰€ä»¥æ²¡æœ‰å´©æºƒçš„åŸå› æ˜¯trampoline pageåœ¨U/Kä¸­æ˜ å°„ç›¸åŒ</p>
</li>
<li class="lvl-2">
<p>OSæ€»æ˜¯ä»Kernelå¯åŠ¨ï¼Œè®¾ç½®å¥½ä¸€åˆ‡ä¸Trapsæœ‰å…³çš„registeråè½¬ç§»åˆ°User</p>
</li>
<li class="lvl-2">
<p>sretæ˜¯ä»supervisor modeåˆ‡æ¢åˆ°user modeçš„RISCV-VæŒ‡ä»¤</p>
</li>
<li class="lvl-2">
<p>åˆ‡æ¢kernel pagetableåï¼Œæˆ‘ä»¬åªæ˜¯æ¢äº†ä¸ªåœ°æ–¹æ‰§è¡Œcç¨‹åº</p>
</li>
<li class="lvl-2">
<p>åœ¨usertrap()ä¸­scause = 8ï¼Œä»£è¡¨æˆ‘ä»¬æ˜¯å› ä¸ºç³»ç»Ÿè°ƒç”¨æ¥åˆ°è¿™é‡Œ</p>
</li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C</a><a class="post-meta__tags" href="/tags/OS/">OS</a><a class="post-meta__tags" href="/tags/RISC-V/">RISC-V</a><a class="post-meta__tags" href="/tags/GNU-Make/">GNU Make</a></div><div class="post-share"><div class="social-share" data-image="/image/sheep.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/04/04/6-S081-Lecture-7/" title="MIT 6.S081 Lecture 7: Page faults"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">MIT 6.S081 Lecture 7: Page faults</div></div><div class="info-2"><div class="info-item-1">Reading  Read 4.6   Implenment VM features using page fault   lazy allocation   copy on write fork   demand paging   memory mapped files   Virtual Memory benefits   Isolation   level of indirection  trampline page guard page    Information needed   the faulting VA -&gt; stval register   type pf fault -&gt; scause register  load store pc    the VA of Instruction that cause fault -&gt; sepc register | trampframe?   lazy allocation   sbrk()åŸæœ¬åº”ä¸ºè¿›ç¨‹æ”¹å˜å †çš„å¤§å°ï¼Œåˆ†é…å†…å­˜    sbrk()ç³»ç»Ÿè°ƒç”¨åŸºæœ¬ä¸åšäº‹æƒ…ï¼Œåªp-&gt;size + n   ...</div></div></div></a><a class="pagination-related" href="/2023/03/31/Literature-and-Philosophy/" title="Literature and Philosophy"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">Literature and Philosophy</div></div><div class="info-2"><div class="info-item-1">Book List  Literature å¾·  é­”å±±  ä¸­  æ´»ç€  Philosophy </div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/05/03/6-S081-Lab-thread/" title="MIT 6.S081 Lab thread"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-03</div><div class="info-item-2">MIT 6.S081 Lab thread</div></div><div class="info-2"><div class="info-item-1">Compulsory exercises Preparation  reading  To start the lab, switch to the thread branch:  123git fetchgit checkout threadmake clean  Uthread: switching between threads (moderate) Using threads (moderate) Barrier(moderate) Optional challenge exercises The user-level thread package interacts badly with the operating system in several ways. For example, if one user-level thread blocks in a system call, another user-level thread wonâ€™t run, because the user-level threads scheduler doesnâ€™t know th...</div></div></div></a><a class="pagination-related" href="/2023/04/28/6-S081-Lecture-17/" title="MIT 6.S081 Lecture 17: Virtual memory for applications"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-28</div><div class="info-item-2">MIT 6.S081 Lecture 17: Virtual memory for applications</div></div><div class="info-2"><div class="info-item-1">Reading  Read Virtual Memory Primitives for User Programs (1991)   </div></div></div></a><a class="pagination-related" href="/2023/04/23/6-S081-Lab-cow/" title="MIT 6.S081 Lab cow"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-23</div><div class="info-item-2">MIT 6.S081 Lab cow</div></div><div class="info-2"><div class="info-item-1">Compulsory exercises Preparation  To start the lab, switch to the cow branch:  123git fetchgit checkout cowmake clean  OSçœŸä¸æ˜¯äººå†™çš„æŠŠğŸ˜­   Implement copy-on write(hard)  å½“xv6 forkä¸€ä¸ªå­è¿›ç¨‹æ—¶ï¼Œéœ€è¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œè¿™ä¸ä»…å ç”¨äº†ç©ºé—´ï¼Œä¹Ÿæ¶ˆè€—äº†æ—¶é—´ï¼Œä½ çš„ä»»åŠ¡æ˜¯é‡‡ç”¨å†™æ—¶å¤åˆ¶ï¼Œfork()æ—¶childä½¿ç”¨parentçš„å†…å­˜ç©ºé—´ï¼Œå³å­è¿›ç¨‹æ˜ å°„åˆ°çˆ¶è¿›ç¨‹çš„ç‰©ç†ç©ºé—´ä¸Šï¼Œå½“è¿›ç¨‹è¦å†™æ—¶ï¼Œè§¦å‘Page Fault å®ç°COW  ä¿®æ”¹uvmcopy()ä»¥åœ¨fork()æ—¶ä¸åˆ†é…æ–°pageï¼Œè€Œæ˜ å°„åˆ°çˆ¶è¿›ç¨‹  vm.c uvmcopy()1234567891011121314151617181920212223242526272829303132intuvmcopy(pagetable_t old, pagetable_t new, uint64 sz)&#123;  pte_t *pte;  uint64 pa, i;  uint fla...</div></div></div></a><a class="pagination-related" href="/2023/04/22/6-S081-Lecture-16/" title="MIT 6.S081 Lecture 16: File system performance and fast crash recovery"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-22</div><div class="info-item-2">MIT 6.S081 Lecture 16: File system performance and fast crash recovery</div></div><div class="info-2"><div class="info-item-1">Reading  Read Journaling the Linux ext2fs Filesystem (1998)  Information   ç¬¬ä¸€èŠ‚OSè®ºæ–‡çš„é˜…è¯»è®²åº§    ext3   â€œlogâ€ = journal   ext3 = ext2 + journal   xv6 log review ext3 log ext3 log format ASYNC Batching Concurrency ext3 code steps in commit </div></div></div></a><a class="pagination-related" href="/2023/04/22/6-S081-Lecture-15/" title="MIT 6.S081 Lecture 15: Crash recovery"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-22</div><div class="info-item-2">MIT 6.S081 Lecture 15: Crash recovery</div></div><div class="info-2"><div class="info-item-1">Reading  Read logging sections of â€œFile systemâ€ read code   Information   æœ€åä¸€èŠ‚å…³äºxv6çš„è®²åº§äº†ï¼Œåé¢çš„é‡ç‚¹ä¼šæ”¾åœ¨æ“ä½œç³»ç»Ÿè®ºæ–‡çš„é˜…è¯»ä¸Š   å†è§äº†æ‰€æœ‰çš„xv6 ğŸ˜­    Problem   crashå¦‚ç”µæºä¸­æ–­ï¼Œç³»ç»Ÿé‡å¯ç­‰   crashä¼šä½¿å¾—å»ºç«‹åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿè¿›å…¥ä¸æ­£ç¡®çš„çš„çŠ¶æ€ï¼Œæ€æ ·ä¿è¯crashåç»´æŒæ­£ç¡®çš„çŠ¶æ€å‘¢ï¼Ÿ   è§£å†³æ–¹æ¡ˆæ˜¯logging   Risk   æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œæ˜¯å¤šæ­¥çš„   å¦‚æœcrashåé‡å¯ï¼Œå¾ˆå¯èƒ½è¦ä¹ˆå†æ¬¡crashï¼Œè¦ä¹ˆè¯»å†™äº†é”™è¯¯çš„æ•°æ®   logging   logçš„æ­¥éª¤   log writes commit op install clean log logèƒ½å¤Ÿä¿è¯æ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„åŸå­æ€§ï¼Œå¹¶æä¾›å¿«é€Ÿæ¢å¤çš„èƒ½åŠ›ï¼Œåœ¨ä¸åŒæ­¥éª¤crashéƒ½æœ‰ä¸åŒçš„æ¢å¤æ–¹æ¡ˆ    logçš„å†…å®¹   å†…å­˜ä¸­æœ‰ç£ç›˜ä¸­logçš„cache    Challenges   eviction  ä¸è¦é©±é€æ­£åœ¨logçš„block    fs operation must fit log  logé™åˆ¶äº†æ–‡ä»¶ç³»ç»Ÿä¸€...</div></div></div></a><a class="pagination-related" href="/2023/04/20/6-S081-Lecture-14/" title="MIT 6.S081 Lecture 14: File systems"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-20</div><div class="info-item-2">MIT 6.S081 Lecture 14: File systems</div></div><div class="info-2"><div class="info-item-1">Reading  Read Chapter8 read code    File System   User-friendly names/pathnames   Share files between users/process   Persistence/durability   Why intersting?   Abstraction is useful   Crash safety   Disk layout   Performance -&gt; Storage devices are slow -&gt; to be fast  storage -&gt; buffercache device -&gt; concurrency    API example    xv6æ–‡ä»¶ç³»ç»Ÿæä¾›çš„APIå®ç°äº†æ–‡ä»¶ç³»ç»ŸåŸºæœ¬çš„ç”¨æˆ·çº§æ“ä½œ   FS structure    inodeå«æœ‰æ–‡ä»¶çš„ä¿¡æ¯ï¼Œä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶   inodeçš„å¤§å°æ˜¯64Bytes   FS Layer    æ–‡ä»¶ç³»ç»Ÿçš„å¤šå±‚ç»“æ„æŠ½è±¡äº†ç¡¬ä»¶ï¼Œå¹¶ä¸ºè½¯ä»¶æä¾›äº†æ¥å£   Storage devices    è¿™é‡Œéœ€è¦...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/image/sheep.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Huayi</div><div class="author-info-description">Time to Code.</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">92</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">18</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/huaeryi"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ğŸš§æ–½å·¥ä¸­...</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Reading-12"><span class="toc-number">1.</span> <span class="toc-text">Reading</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Traps"><span class="toc-number">2.</span> <span class="toc-text">Traps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gdb%E8%B0%83%E8%AF%95traps"><span class="toc-number">3.</span> <span class="toc-text">gdbè°ƒè¯•traps</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/13/CSAPP-bomblab/" title="CSAPP bomblab">CSAPP bomblab</a><time datetime="2023-11-13T13:54:06.000Z" title="å‘è¡¨äº 2023-11-13 21:54:06">2023-11-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/11/CSAPP-datalab/" title="CSAPP datalab">CSAPP datalab</a><time datetime="2023-11-11T05:46:54.000Z" title="å‘è¡¨äº 2023-11-11 13:46:54">2023-11-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/08/Latex/" title="Latex">Latex</a><time datetime="2023-11-08T04:39:59.000Z" title="å‘è¡¨äº 2023-11-08 12:39:59">2023-11-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/04/hackergame2023/" title="Hackergame2023">Hackergame2023</a><time datetime="2023-11-04T12:01:38.000Z" title="å‘è¡¨äº 2023-11-04 20:01:38">2023-11-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/20/About-Physics/" title="About Physics">About Physics</a><time datetime="2023-10-20T02:18:49.000Z" title="å‘è¡¨äº 2023-10-20 10:18:49">2023-10-20</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Huayi</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 6.1.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>